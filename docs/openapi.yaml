openapi: 3.0.3
info:
  title: Vendor Management API
  description: |
    API for the Vendor Management System - part of the Agentic Event Orchestrator.
    
    ## Authentication
    Most endpoints require a Bearer token in the Authorization header.
    Tokens are obtained via the login endpoint and refreshed via refresh-token.
    
    ## Rate Limiting
    - Auth endpoints: 10 requests per 15 minutes
    - General API: 100 requests per 15 minutes per vendor
    - Password reset: 3 requests per hour
  version: 1.0.0
  contact:
    email: support@vendormanagement.com

servers:
  - url: http://localhost:3001/api/v1
    description: Local development
  - url: https://api.vendormanagement.com/api/v1
    description: Production

tags:
  - name: Auth
    description: Authentication and registration
  - name: Profile
    description: Vendor profile management
  - name: Services
    description: Service offerings CRUD
  - name: Pricing
    description: Pricing management
  - name: Bookings
    description: Booking management
  - name: Integration
    description: API keys and webhooks

paths:
  /vendors/register:
    post:
      tags: [Auth]
      summary: Register a new vendor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '409':
          description: Email already registered

  /vendors/login:
    post:
      tags: [Auth]
      summary: Login to vendor portal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful or 2FA required
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/LoginResponse'
                  - $ref: '#/components/schemas/TwoFactorRequiredResponse'
        '401':
          description: Invalid credentials

  /vendors/refresh-token:
    post:
      tags: [Auth]
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Tokens refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'

  /vendors/me:
    get:
      tags: [Profile]
      summary: Get current vendor profile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Vendor profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VendorProfile'
    put:
      tags: [Profile]
      summary: Update vendor profile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateVendorRequest'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Vendor'

  /vendors/me/services:
    get:
      tags: [Services]
      summary: List vendor services
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/ServiceCategory'
        - name: isActive
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Paginated list of services
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedServices'
    post:
      tags: [Services]
      summary: Create a new service
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateServiceRequest'
      responses:
        '201':
          description: Service created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'

  /vendors/me/services/{id}:
    get:
      tags: [Services]
      summary: Get service by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Service details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
    put:
      tags: [Services]
      summary: Update service
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateServiceRequest'
      responses:
        '200':
          description: Service updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
    delete:
      tags: [Services]
      summary: Delete service
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Service deleted

  /vendors/me/pricing:
    get:
      tags: [Pricing]
      summary: List pricing entries
      security:
        - BearerAuth: []
      parameters:
        - name: serviceId
          in: query
          schema:
            type: string
            format: uuid
        - name: activeOnly
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: Paginated pricing list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPricing'
    post:
      tags: [Pricing]
      summary: Create pricing entry
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePricingRequest'
      responses:
        '201':
          description: Pricing created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pricing'

  /vendors/me/pricing/bulk:
    post:
      tags: [Pricing]
      summary: Bulk create pricing entries
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                prices:
                  type: array
                  items:
                    $ref: '#/components/schemas/CreatePricingRequest'
      responses:
        '201':
          description: Bulk pricing created
          content:
            application/json:
              schema:
                type: object
                properties:
                  created:
                    type: array
                    items:
                      $ref: '#/components/schemas/Pricing'
                  errors:
                    type: array
                    items:
                      type: string

  /vendors/me/bookings:
    get:
      tags: [Bookings]
      summary: List bookings
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Paginated bookings list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedBookings'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    RegisterRequest:
      type: object
      required:
        - vendorName
        - contactEmail
        - firstName
        - lastName
        - email
        - password
        - confirmPassword
      properties:
        vendorName:
          type: string
          minLength: 2
        businessType:
          type: string
        contactEmail:
          type: string
          format: email
        phone:
          type: string
        website:
          type: string
          format: uri
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        confirmPassword:
          type: string

    RegisterResponse:
      type: object
      properties:
        message:
          type: string
        vendor:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
            email:
              type: string

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        twoFactorCode:
          type: string
          maxLength: 6

    LoginResponse:
      type: object
      properties:
        message:
          type: string
        user:
          $ref: '#/components/schemas/User'
        vendor:
          $ref: '#/components/schemas/Vendor'
        accessToken:
          type: string
        refreshToken:
          type: string

    TwoFactorRequiredResponse:
      type: object
      properties:
        message:
          type: string
        requiresTwoFactor:
          type: boolean

    TokenResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        role:
          type: string
          enum: [owner, admin, staff, readonly]
        twoFactorEnabled:
          type: boolean

    Vendor:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        businessType:
          type: string
        contactEmail:
          type: string
        phone:
          type: string
        status:
          type: string
          enum: [PENDING, ACTIVE, SUSPENDED, DEACTIVATED]
        tier:
          type: string
          enum: [BRONZE, SILVER, GOLD]
        verified:
          type: boolean

    VendorProfile:
      type: object
      properties:
        vendor:
          $ref: '#/components/schemas/Vendor'
        user:
          $ref: '#/components/schemas/User'

    UpdateVendorRequest:
      type: object
      properties:
        name:
          type: string
        businessType:
          type: string
        phone:
          type: string
        description:
          type: string
        website:
          type: string

    ServiceCategory:
      type: string
      enum:
        - venue
        - catering
        - photography
        - videography
        - music
        - decoration
        - transportation
        - accommodation
        - planning
        - entertainment
        - equipment
        - staffing
        - other

    UnitType:
      type: string
      enum:
        - per_hour
        - per_day
        - per_event
        - per_person
        - per_unit
        - flat_rate
        - custom

    Service:
      type: object
      properties:
        id:
          type: string
          format: uuid
        vendorId:
          type: string
          format: uuid
        name:
          type: string
        category:
          $ref: '#/components/schemas/ServiceCategory'
        description:
          type: string
        unitType:
          $ref: '#/components/schemas/UnitType'
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    CreateServiceRequest:
      type: object
      required:
        - name
        - category
      properties:
        name:
          type: string
        category:
          $ref: '#/components/schemas/ServiceCategory'
        description:
          type: string
        unitType:
          $ref: '#/components/schemas/UnitType'
        minQuantity:
          type: integer
        maxQuantity:
          type: integer
        isActive:
          type: boolean
          default: true

    UpdateServiceRequest:
      type: object
      properties:
        name:
          type: string
        category:
          $ref: '#/components/schemas/ServiceCategory'
        description:
          type: string
        isActive:
          type: boolean

    PaginatedServices:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Service'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        totalPages:
          type: integer

    Pricing:
      type: object
      properties:
        id:
          type: string
          format: uuid
        serviceId:
          type: string
          format: uuid
        price:
          type: number
        currency:
          type: string
        effectiveDate:
          type: string
          format: date
        isActive:
          type: boolean
        status:
          type: string
          enum: [draft, pending_approval, active, expired, rejected]

    CreatePricingRequest:
      type: object
      required:
        - serviceId
        - price
        - effectiveDate
      properties:
        serviceId:
          type: string
          format: uuid
        price:
          type: number
        currency:
          type: string
          default: USD
        effectiveDate:
          type: string
          format: date
        expiryDate:
          type: string
          format: date

    PaginatedPricing:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Pricing'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        totalPages:
          type: integer

    Booking:
      type: object
      properties:
        id:
          type: string
          format: uuid
        vendorId:
          type: string
          format: uuid
        serviceId:
          type: string
          format: uuid
        eventName:
          type: string
        eventDate:
          type: string
          format: date
        status:
          type: string
          enum: [pending, confirmed, in_progress, completed, cancelled, rejected]
        totalPrice:
          type: number

    PaginatedBookings:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Booking'
        total:
          type: integer
        page:
          type: integer
        limit:
          type: integer
        totalPages:
          type: integer
